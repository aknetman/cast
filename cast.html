<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
	  body {
	    overflow:hidden;
	  }
      div{
	    height:720PX;
	    width:1280PX;
	    text-align:center;
	    border:0px solid silver;
	    display: table-cell;
	    vertical-align:middle;
	    color:#FFFFFF;
	    background-color:#000000;
	    font-weight:bold;
	    font-family:Verdana, Geneva, sans-serif;
	    font-size:40px;
	}
    </style>
    <title>Cast Hello Text</title>
  </head>
 <body>
        <!-- 
	<DIV id="message">Talk to me</DIV> 
	-->
    <script src="pixi.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG);
        window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
        console.log('Starting Receiver Manager');
        
        // handler for the 'ready' event
        castReceiverManager.onReady = function(event) {
          console.log('Received Ready event: ' + JSON.stringify(event.data));
          window.castReceiverManager.setApplicationState("Application status is ready...");
        };
        
        // handler for 'senderconnected' event
        castReceiverManager.onSenderConnected = function(event) {
          console.log('Received Sender Connected event: ' + event.data);
          console.log(window.castReceiverManager.getSender(event.data).userAgent);
        };
        
        // handler for 'senderdisconnected' event
        castReceiverManager.onSenderDisconnected = function(event) {
          console.log('Received Sender Disconnected event: ' + event.data);
          if (window.castReceiverManager.getSenders().length == 0) {
	        window.close();
	      }
        };
        
        // handler for 'systemvolumechanged' event
        castReceiverManager.onSystemVolumeChanged = function(event) {
          console.log('Received System Volume Changed event: ' + event.data['level'] + ' ' +
              event.data['muted']);
        };

        // create a CastMessageBus to handle messages for a custom namespace
        window.messageBus =
          window.castReceiverManager.getCastMessageBus(
              'urn:x-cast:com.aknetman.MyCast');

        // handler for the CastMessageBus message event
        window.messageBus.onMessage = function(event) {
          console.log('Message [' + event.senderId + ']: ' + event.data);
          // display the message from the sender
          displayText(event.data);
          // inform all senders on the CastMessageBus of the incoming message event
          // sender message listener will be invoked
          window.messageBus.send(event.senderId, event.data);
        }

        // initialize the CastReceiverManager with an application status message
        window.castReceiverManager.start({statusText: "Application is starting"});
        console.log('Receiver Manager started');
      };
      
      // utility function to display the text message in the input field
      function displayText(text) {
        console.log(text);
        document.getElementById("message").innerHTML=text;
        window.castReceiverManager.setApplicationState(text);
      };


//Test that Pixi is working
console.log(PIXI);


//Aliases
var Container = PIXI.Container,
    autoDetectRenderer = PIXI.autoDetectRenderer,
    loader = PIXI.loader,
    resources = PIXI.loader.resources,
    Sprite = PIXI.Sprite;
xres = 1280;
yres = 720;

//Create a Pixi stage and renderer and add the 
//renderer.view to the DOM
var stage = new Container(),
    renderer = autoDetectRenderer(xres, yres);
document.body.appendChild(renderer.view);

//load an image and run the `setup` function when it's done
loader
  .add("images/cat.png")
  .load(setup);

var cat;
var direction = true;
var  xstepsize = 10;
var  vstepsize = 4;

function setup() {

  //Create the `cat` sprite, add it to the stage, and render it
  cat = new Sprite(resources["images/cat.png"].texture);  
  stage.addChild(cat);
  cat.x = -64;
  
var message = new Text(
  "Hello Pixi!",
  {font: "32px sans-serif", fill: "white"}
);

message.position.set(54, 96);
stage.addChild(message);

  renderer.render(stage);


}
function gameLoop() {

  //Loop this function at 60 frames per second
  requestAnimationFrame(gameLoop);
  //xstepsize = 10;
  //vstepsize = 4;

  //Move the cat .. each frame
  if (cat.x > xres/2 -20 && cat.x < xres/2 +20) {
    
    if (direction == true){
	direction = false;
	//vstepsize -= 8;
	}else{
	direction = true;
	//vstepsize += 8;
	}
  }
if (direction == true){
  cat.x += xstepsize;
}else{
  cat.x -= xstepsize;
}
  cat.y += vstepsize;
  if (cat.x > xres) {
    cat.x = -64;
    cat.y += 20;
  }
if (cat.x < -64){
  cat.x = xres
vstepsize += 8;
}
  if (cat.y > yres){
    cat.y = -64
vstepsize -= 8;
  }

  //Render the stage to see the animation
  renderer.render(stage);
}

//Start the game loop
gameLoop();
    </script>
  </body>
</html>
